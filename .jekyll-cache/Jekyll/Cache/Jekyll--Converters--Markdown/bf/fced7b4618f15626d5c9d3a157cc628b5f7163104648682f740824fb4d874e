I"ta<h3 id="extension-hacking">Extension Hacking</h3>
<p>I wanted to share a few examples of a powerful skill that I’ve been gradually picking up over the last year. It is simply the ability to quickly hack together custom browser extensions in Chrome and using them to customize my favorite websites. Writing extensions is very fast: you need a short manifest file that contains some boring meta information, a few js/html files with your code in a folder, and then you simply activate the folder as an extension from the Extensions menu with a few clicks. In general, you can do a lot of fancy things with extensions:</p>

<ul>
  <li>add buttons, context-menu items</li>
  <li>modify functionality of Omnibox</li>
  <li>create extension-specific webpages that display various data/settings</li>
  <li>your extension is allowed to have local (or synced), persistent storage of data</li>
  <li>you can run almost arbitrary Javascript over the DOM of any webpage</li>
</ul>

<p>I can’t stress how powerful the last item is. You can run Javascript. On top of any webpage. You can Read the page DOM. You can write to it, automatically, on load of the webpage or even periodically! This gives you complete freedom in modifying any webpage to your tastes: remove annoying content, add new features, log/scrape website data, change the layout, etc. It’s completely crazy!</p>

<p>I’ll walk you through some examples with possible mods of Twitter just to give you a glimpse of how easy and powerful this can be. Twitter is fun and I use it often, but their website is annoying, has some ugly elements, and sometimes lacks certain functionality I would like it to have. A normal person would request features and wait, but with the dark arts of extension hacking we can do much better. Lets get right to it.</p>

<h3 id="fixing-the-ugly">Fixing the Ugly</h3>

<p>A recent change on Twitter added this ugly text, visible by default and always, on every single tweet:
<img src="/assets/chrome1.jpeg" /></p>

<p>I understand it gets people to accidentally click on these more and pads Twitter’s engagement numbers, but it’s useless, ugly, and it just takes up too much space. Lets right click on one of these and choose Inspect Element. This opens up the HTML of the page and here we see the culprit DOM elements:</p>

<p><img src="/assets/chrome2.jpeg" /></p>

<p>So we have a list <code class="language-plaintext highlighter-rouge">&lt;ul&gt;&lt;/ul&gt;</code> with items <code class="language-plaintext highlighter-rouge">&lt;li&gt;</code> one for each of Reply, Retweet, Favorite and More. Inside every of them they have a <code class="language-plaintext highlighter-rouge">&lt;a&gt;</code>(anchor that processes the click action), deeper we have a <code class="language-plaintext highlighter-rouge">&lt;span&gt;</code> that becomes the icon, and finally followed by the ugly text wrapped in <code class="language-plaintext highlighter-rouge">&lt;b&gt;</code>. That looks easy enough, we will find all these elements based on their  class attribute, descend down to find the text and get rid of it.  So we create a new folder for TwitterClean extension, copy paste some manifest boring code and set it up to load a javascript file anytime twitter loads. For example, right after twitter.com page loads, lets execute:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">clean_twitter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">ugly</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">ugly</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">.action-reply-container</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ugly</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">.action-rt-container</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ugly</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">.action-del-container</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ugly</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">.action-fav-container</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ugly</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="dl">'</span><span class="s1">.more-tweet-actions</span><span class="dl">'</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">ugly</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">u</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ugly</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">u</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Load the Extension, refresh Twitter and poof! All the text is gone and we’re just left with the icons. These suffice. Oh and while we’re at code we run automatically on load of twitter.com, lets slip this one is as well:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.promoted-tweet</span><span class="dl">'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span> <span class="c1">// oops!</span>
</code></pre></div></div>

<p>I’ll let you figure out what that single naughty line of code does for you :)</p>

<h3 id="loading-new-tweets-automatically">Loading new tweets automatically</h3>

<p>Here’s another annoyance: you have your Twitter running on your side monitor and new tweets come in, but Twitter doesn’t load them automatically! It just shows this:</p>

<p><img src="/assets/chrome3.jpeg" /></p>

<p>That’s the passive aggressive look of Twitter telling you that there are two more tweets to show, but also refusing to actually show them. That would be too useful to their users. Instead, they want you to stop what you’re doing and click the button to load the new tweets. Luckily, you are skilled at extension hacking so you can simply right click the caption, go to Inspect Element, and see that the &lt;div&gt; element that tells you there are more tweets has class “js-new-tweets-bar”. Easy enough:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">periodic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">L</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">'</span><span class="s1">js-new-tweets-bar</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="nx">L</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">click</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">periodic</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</code></pre></div></div>

<p>When this gets run when <strong>twitter.com</strong> loads, it sets up the code to look for the annoying bar every second (1000 milliseconds) and then runs its click event handler which loads the new tweets. That’s all it takes, and now your tweets are streaming down automatically whenever they are available without you having to explicitly refresh them all the time. We’ve only written code for 5 minutes and in that time we tweaked the way Twitter looked, removed some “functionality” and added some functionality! We’re on a roll! Let’s do something fancier now.</p>

<h3 id="highlighting-tweets-from-rare-tweeters-wait-or-tweepers">Highlighting tweets from rare tweeters (wait, or tweepers?)</h3>

<p>One day I decided to collect tweets on my timeline over a period of a week using Twitter’s REST API and saw that 30 accounts make up 50% of everything I see on Twitter. Since I follow 384 accounts in total, that’s only 7%! Unfortunately, for Twitter every tweet is created equal, which means that this annoying social media guru person who tweets 100 times a day completely drowns tweets coming from your other friends who believe that one should also have something worthy of tweeting too. Okay well it’s not exactly like that but I wished there was a mechanism for highlighting the very infrequent tweeters and seeing that low frequency content. Twitter will never implement this because it makes Zero sense for their revenue model, but luckily, we can hack this together quite easily! First, here’s a function that goes through all tweets on your timeline, looks at who tweeted, and “charges” every unique tweet to the originating user:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">charge_tweets</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// get all tweets in twitter timeline</span>
  <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.tweet</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">it</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

    <span class="c1">// extract information from tweet HTML</span>
    <span class="kd">var</span> <span class="nx">original_user</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">it</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-screen-name</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">retweeter</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">it</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-retweeter</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">tweet_id</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">it</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-tweet-id</span><span class="dl">'</span><span class="p">);</span>

    <span class="c1">// a bit of logic</span>
    <span class="kd">var</span> <span class="nx">charged_user</span> <span class="o">=</span> <span class="nx">original_user</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">retweeter</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">charged_user</span> <span class="o">=</span> <span class="nx">retweeter</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// charge tweet to the user</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">charge</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">charged_user</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">L</span> <span class="o">=</span> <span class="nx">charge</span><span class="p">[</span><span class="nx">charged_user</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nx">tweet_id</span><span class="p">,</span> <span class="nx">L</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tweet_id</span><span class="p">);</span>  
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">charge</span><span class="p">[</span><span class="nx">charged_user</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">tweet_id</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Basically, it turns out every tweet has class “tweet”, so it is trivial to iterate over them as seen above. Similarly, by inspecting the way the HTML is laid out, it turns out we can simply scrape the user and the (unique) tweet id and use it to build up a dictionary of <code class="language-plaintext highlighter-rouge">user_string -&gt; [tweet id, ...]</code>. Of course, we will have to let this accumulate for a few days before it measures a good tweeting frequency distribution for all people we follow as we visit Twitter again and again always seeing new tweets from more people. But this also means we have to load and save the <strong>charge</strong> dictionary from Chrome’s local extension storage or otherwise we would lose all our charging work whenever we close the Tab! Easy enough:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">save_charge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="kd">set</span><span class="p">({</span><span class="dl">'</span><span class="s1">charge</span><span class="dl">'</span><span class="p">:</span> <span class="nx">charge</span><span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">load_charge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">charge</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">charge</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">charge</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">charge</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">loaded tweet frequency stats:</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">charge</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">no tweet frequency to load</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we just make sure to run load_charge() at start up, and save_charge() anytime there are new tweets and our <em>charge</em> dictionary changes. Based on this <em>charge</em> dictionary we can easily find, say, the 50th percentile frequency, and highlight any tweet that comes from a user who tweets less often than 50% of the users we follow:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">display_charges</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.tweet</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">it</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

    <span class="c1">// ... as above and then:</span>

    <span class="kd">var</span> <span class="nx">charged_tweets</span> <span class="o">=</span> <span class="nx">charge</span><span class="p">[</span><span class="nx">charged_user</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">charge_count</span> <span class="o">=</span> <span class="nx">charged_tweets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="c1">// adjust highlight color of the tweet according to rareness</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">charge_percentile</span> <span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">charge_count</span> <span class="o">/</span> <span class="nx">charge_percentile</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">ratio</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">it</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">background-color</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">rgb(255,255,</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">)</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is just one possibility out of many. Here, <em>ratio</em> will be low for users who rarely tweet, and we’re setting their tweet to be yellow based on their rareness. Very hard to not notice on your timeline! :) And while we’re at it, why not also fit in:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">VIP</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">elonmusk</span><span class="dl">'</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">inArray</span><span class="p">(</span><span class="nx">charged_user</span><span class="p">,</span> <span class="nx">VIP</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="nx">it</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">background-color</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">rgb(150,255,150)</span><span class="dl">'</span><span class="p">);</span> 
<span class="p">}</span>
</code></pre></div></div>

<p>This way, Elon Musk’s (or your other Twitter favorites) tweets will always glow a vibrant, green color that is hard to notice! Nice. Here’s what we get:</p>

<p><img src="/assets/chrome4.jpeg" /></p>

<p>Just look at that! Mashable and some person who needed every single one of his followers to know “Aarrrgh” look normal, Elon’s tweets are hard to miss green, and someone who doesn’t tweet relatively as often is highlighted a bit as yellow.</p>

<h3 id="summary">Summary</h3>

<p>It took us ~100 lines and 10 minutes of Javascript (with a bit of practice) and we tweaked Twitter’s look, removed err… undesirable content, made Twitter autorefresh, and added an entirely new feature that highlights infrequent tweepers!</p>

<p>Yet we’ve only barely scratched the surface. If you’re  comfortable with navigating HTML of pages with Chrome’s awesome inspector and writing HTML/Javascript/CSS, these quick hacks have the potential to significantly improve your online experience by giving you powerful options for customizing your favorite sites. And if you are not comfortable, perhaps it’s time to head over to Chrome Extensions “<a href="http://developer.chrome.com/extensions/getstarted.html">Getting Started</a>” and write a few hacks :)</p>

<p>Oh, and if you’d like the full code of the above, you may find it here: <a href="http://cs.stanford.edu/people/karpathy/twitteropt.zip">LINK</a> (Note it is a bit rough around the edges, but then it is a quick hack after all!). Let me know if you have any issues on <a href="https://twitter.com/karpathy">@karpathy</a>, and until later!</p>
:ET